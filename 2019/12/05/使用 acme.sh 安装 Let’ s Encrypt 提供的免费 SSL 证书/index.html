<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="专注于 MySQL、PHP、Elasticsearch、LNMP、Redis">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/jingjie.github.io/img/favicon.ico">

    <title>
        
        使用 acme.sh 安装 Let’ s Encrypt 提供的免费 SSL 证书 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/jingjie.github.io/css/aircloud.css">
    <link rel="stylesheet" href="/jingjie.github.io/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/jingjie.github.io/images/tong.jpg" />
        </div>
        <div class="name">
            <i>静节</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/jingjie.github.io/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/jingjie.github.io/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/jingjie.github.io/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/jingjie.github.io/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#方式一"><span class="toc-text">方式一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#测试环境"><span class="toc-text">测试环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-介绍"><span class="toc-text">1. 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-安装"><span class="toc-text">2. 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-申请证书"><span class="toc-text">3. 申请证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-nginx配置"><span class="toc-text">4. nginx配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#方式二"><span class="toc-text">方式二</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        使用 acme.sh 安装 Let’ s Encrypt 提供的免费 SSL 证书
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-12-05 11:51:55</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/jingjie.github.io/tags/#Linux" title="Linux">Linux</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h1 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h1><hr>
<h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><p>Ubuntu 18.04</p>
<p>Nginx</p>
<hr>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ul>
<li>开放云服务器 443 端口</li>
<li>开放系统 443 端口</li>
</ul>
<p>Note：https 成功后，记得把网站所有连接换成 https</p>
<hr>
<h3 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h3><p>Let’ s Encrypt已有免费的证书可用，以后的网站估计都要上https的吧，所以把我的网站上的证书换了一下，这节主要是参考使用 acme.sh 给 Nginx 安装 Let’ s Encrypt 提供的免费 SSL 证书这篇文章，并结合自己的情况，把我的经验记录下来。</p>
<h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h3><p>我们使用acme.sh来申请和管理证书，它很简单用，还能够利用crontab自动更新证书，而且是默认就有的功能。</p>
<p>首先安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、cd</span><br><span class="line">2、wget -O -  https://get.acme.sh | sh</span><br><span class="line">3、cd .acme.sh</span><br></pre></td></tr></table></figure>

<p>安装完之后，可以退出登录，再重新登录，或者执行一下<strong>『source ~/.bashrc』</strong>。</p>
<p>之后就可以使用 <strong>acme.sh</strong> 命令了。</p>
<h3 id="3-申请证书"><a href="#3-申请证书" class="headerlink" title="3. 申请证书"></a>3. 申请证书</h3><p>首先申请和下载证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -w 后面写上你自己的网站根目录 -d 自己的网站域名</span></span><br><span class="line">./acme.sh --issue -d www.nicefutureworld.com -w /home/wwwroot/www.nicefutureworld.com/current/public</span><br></pre></td></tr></table></figure>

<p>申请成功后，证书会被保存在 .acme.sh 目录里面的 <a href="http://www.nicefutureworld.com" target="_blank" rel="noopener">www.nicefutureworld.com</a>  目录里面：</p>
<p><img src="https://www.nicefutureworld.com/storage/article/2019/07/25/5gbruO0pn4Ln71CQSGj3q9UWbs7lEXRNv5mMg4Vh.png" alt="fc61f2da01de2d5389a4e5e0f6e9119.png"></p>
<p>接下来我们要把证书安装到你的应用中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ssl 文件夹不存在则先创建，需要有写的权限</span></span><br><span class="line">./acme.sh --installcert -d boat.rails365.net \</span><br><span class="line">               --keypath       /home/wwwroot/www.nicefutureworld.com/ssl/www.nicefutureworld.com.key  \</span><br><span class="line">               --fullchainpath /home/wwwroot/www.nicefutureworld.com/ssl/www.nicefutureworld.com.key.pem \</span><br><span class="line">               --reloadcmd     "sudo lnmp reload"</span><br></pre></td></tr></table></figure>

<p>接下来，还需要再生成一个文件，很多ssl的配置都需要它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl dhparam -out /home/wwwroot/www.nicefutureworld.com/ssl/dhparam.pem 2048</span><br></pre></td></tr></table></figure>

<h3 id="4-nginx配置"><a href="#4-nginx配置" class="headerlink" title="4. nginx配置"></a>4. nginx配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">upstream boat_manager &#123;</span><br><span class="line">	server unix:///home/wwwroot/www.nicefutureworld.com/shared/tmp/sockets/puma.sock fail_timeout=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 443 ssl;</span><br><span class="line">	server_name www.nicefutureworld.com;</span><br><span class="line">	ssl_certificate         /home/wwwroot/www.nicefutureworld.com/ssl/www.nicefutureworld.com.key.pem;</span><br><span class="line">	ssl_certificate_key     /home/wwwroot/www.nicefutureworld.com/ssl/www.nicefutureworld.com.key;</span><br><span class="line">	# ssl_dhparam </span><br><span class="line">	ssl_dhparam             /home/wwwroot/www.nicefutureworld.com/ssl/dhparam.pem;</span><br><span class="line">	root /home/wwwroot/www.nicefutureworld.com/current/public</span><br><span class="line">	keepalive_timeout 70;</span><br><span class="line">	# 其它配置保持不变</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.nicefutureworld.com;</span><br><span class="line">    return 301 https://www.nicefutureworld.com$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>顶层的http指令那里，也需要加上这两行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原文地址：<a href="https://www.qiuzhi99.com/articles/shi-yong-acme-sh-an-zhuang-let-s-encrypt-ti-gong-mian-fei-ssl-zheng-shu" target="_blank" rel="noopener">https://www.qiuzhi99.com/articles/shi-yong-acme-sh-an-zhuang-let-s-encrypt-ti-gong-mian-fei-ssl-zheng-shu</a></p>
<h1 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h1><p>准备：</p>
<blockquote>
<p>先停止 Nginx</p>
</blockquote>
<p>使用：<a href="https://certbot.eff.org" target="_blank" rel="noopener">https://certbot.eff.org</a></p>
<p>选择自己的环境与系统：如 Nginx Ubuntu18.04</p>
<p><img src="https://www.nicefutureworld.com/storage/article/2019/07/25/C1kZHFtlEJ2AVSpUu8jZQlqZAjxNBJl2DZyz7KNu.png" alt="ab86c122dfd676d9b6756551565213f.png"></p>
<p>接下来就是按文档步骤操作：操作完以后把 Nginx 配置跟上一样</p>
<p><img src="https://www.nicefutureworld.com/storage/article/2019/07/25/TT9wnAovZTQ0zMhUMxQQCFlnWUjM3ksb36eC7giu.png" alt="e4bad6e0104596364783869c266cebb.png"></p>
<p><img src="https://www.nicefutureworld.com/storage/article/2019/07/25/5Bc64yUdqCG0XyzFTENee7x9sTzsSpshOEhC5xAB.png" alt="c4f9fe7af9bda18f4fa28453ee554fa.png"></p>
<p><img src="https://www.nicefutureworld.com/storage/article/2019/07/25/qNv7XHvzONrAWSat9yA7JUvG8yoHhLUvCVWFFk4V.png" alt="e835c2150102fdeefeaf207bf03bb5c.png"></p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/nFreeMason">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud" target="_blank" rel="noopener">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/jingjie.github.io/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/jingjie.github.io/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
